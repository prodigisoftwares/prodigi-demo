<!-- Chart Section Partial -->
<div class="bg-white/80 backdrop-blur-sm rounded-3xl p-8 md:p-12 shadow-xl border border-slate-200/50 mb-8">
  <h3 class="text-2xl font-bold text-slate-800 mb-6 text-center">
    Political Spectrum Visualization
  </h3>
  <div class="bg-gradient-to-br from-slate-50 to-slate-100 rounded-2xl p-6">
    <canvas id="spectrumChart" width="600" height="400" class="mx-auto"></canvas>
  </div>
  <div class="mt-4 text-center">
    <p class="text-sm text-slate-500">
      Your position is marked in blue, with similar political figures shown for reference
    </p>
  </div>
</div>

<script>
  (function() {
    const userPoint = {x: {{ x|floatformat:3 }}, y: {{ y|floatformat:3 }}};
    const pols = [
      {% for p in nearest %}
      {label: '{{ p.name|escapejs }}', x: {{ p.x|floatformat:3 }}, y: {{ p.y|floatformat:3 }}},
      {% endfor %}
    ];
    const ctx = document.getElementById('spectrumChart');
    new Chart(ctx, {
      type: 'scatter',
      data: {
        datasets: [
          { label: 'You', pointRadius: 6, data: [{x: userPoint.x, y: userPoint.y}] },
          { label: 'Closest figures', pointRadius: 4, data: pols.map(p => ({x: p.x, y: p.y})) },
        ]
      },
      options: {
        aspectRatio: 1.6,
        scales: {
          x: { type: 'linear', min: -1, max: 1, title: {display: false} },
          y: { type: 'linear', min: -1, max: 1, title: {display: false} }
        },
        plugins: {
          legend: { display: true },
          tooltip: { enabled: false }
        },
        layout: {
          padding: {
            top: 10,
            left: 10,
            right: 80,
            bottom: 10
          }
        },
        animation: {
          onComplete: function() {
            const chart = this;
            const ctx = chart.ctx;

            ctx.font = '12px Arial';
            ctx.fillStyle = '#374151';
            ctx.textAlign = 'left';
            ctx.textBaseline = 'middle';

            // Draw "You" label to the right of user point
            const userMeta = chart.getDatasetMeta(0);
            if (userMeta.data.length > 0) {
              const point = userMeta.data[0];
              ctx.fillText('You', point.x + 8, point.y);
            }

            // Draw political figure labels to the right of their points
            const polsMeta = chart.getDatasetMeta(1);
            polsMeta.data.forEach((point, index) => {
              if (index < pols.length) {
                ctx.fillText(pols[index].label, point.x + 8, point.y);
              }
            });
          }
        }
      }
    });
  })();
</script>
